<div class="max-w-3xl mx-auto">
  <h1 class="text-xl font-bold mb-4">お気に入り</h1>

  <%# タブ（フレーム内に移動） %>

  <!-- 一覧 -->
  <%= turbo_frame_tag "bookmarks_list" do %>
    <!-- タブ（フレーム内に移動） -->
    <div class="flex mb-4 space-x-4 border-b">
      <%= link_to t(".vocabulary"),
          bookmarks_path(type: "Vocabulary"),
          data: { turbo_frame: "bookmarks_list" },
          class: "pb-2 #{ @active_tab == "Vocabulary" ? "border-b-2 border-blue-600 font-semibold" : "text-gray-500" }" %>
      <%= link_to t(".sentence"),
          bookmarks_path(type: "Sentence"),
          data: { turbo_frame: "bookmarks_list" },
          class: "pb-2 #{ @active_tab == "Sentence" ? "border-b-2 border-blue-600 font-semibold" : "text-gray-500" }" %>
    </div>
    <% if @bookmarks.blank? %>
      <p class="text-gray-500"><%= t(".empty") %></p>
    <% else %>
      <ul class="space-y-3">
        <% @bookmarks.each do |bm| %>
          <li class="rounded-2xl border bg-white p-4 shadow hover:shadow-md transition flex items-start justify-between gap-4">
            <div class="pr-3 max-w-[85%]">
              <% if bm.bookmarkable_type == "Vocabulary" %>
                <%= link_to polymorphic_path(bm.bookmarkable), class: "block" do %>
                  <div class="font-semibold text-lg inline"><%= truncate(bm.bookmarkable.word.to_s, length: 24, omission: "…") %></div>
                  <span class="text-sm text-gray-500 ml-1">
                    <%= truncate((bm.bookmarkable.reading.presence || t("vocabularies.index.reading_none")).to_s, length: 48, omission: "…") %>
                    /
                    <%= t("enums.vocabulary.part_of_speech.#{bm.bookmarkable.part_of_speech}") %>
                  </span>

                  <div class="mt-2 pl-3 border-l-4 border-blue-300">
                    <div class="text-[11px] font-semibold text-blue-700 tracking-wide uppercase"><%= t("vocabularies.index.mean_label") %></div>
                    <div class="mt-1 text-sm text-gray-800 leading-relaxed break-words">
                      <%= clamp_lines(bm.bookmarkable.meaning, max_lines: 3) %>
                    </div>
                  </div>

                  <% if bm.bookmarkable.example.present? %>
                    <div class="mt-2 pl-3 border-l-4 border-green-300">
                      <div class="text-[11px] font-semibold text-green-700 tracking-wide uppercase"><%= t("vocabularies.index.example_label") %></div>
                      <div class="mt-1 text-xs text-gray-600 leading-relaxed break-words">
                        <%= clamp_lines(bm.bookmarkable.example, max_lines: 3) %>
                      </div>
                    </div>
                  <% end %>
                <% end %>

                <%# タグ（語彙）: 一覧と同じ色付きチップ＋リンク %>
                <% if bm.bookmarkable.respond_to?(:vocabulary_tags) && bm.bookmarkable.vocabulary_tags.any? %>
                  <div class="relative z-50 pointer-events-auto mt-2 flex flex-wrap gap-2 max-h-16 overflow-y-auto">
                    <% bm.bookmarkable.vocabulary_tags.order(:name).each do |tag| %>
                      <%= link_to tag.name,
                          vocabularies_path(q: { vocabulary_tags_id_in: [tag.id] }),
                          class: "px-2 py-1 rounded-full border text-xs hover:opacity-80",
                          style: "background-color: #{tag.color.presence || '#000'}; color: #fff;" %>
                    <% end %>
                  </div>
                <% end %>

              <% else %>
                <%= link_to polymorphic_path(bm.bookmarkable), class: "block" do %>
                  <div class="text-sm text-gray-500 mb-1"><%= t("bookmarks.index.sentence") %></div>
                  <div class="text-base font-semibold leading-snug"><%= clamp_lines(bm.bookmarkable.body, max_lines: 3) %></div>
                <% end %>

                <%# 種類（文章） %>
                <% raw_cat = bm.bookmarkable.try(:sentence_category) %>
                <% if raw_cat.present? %>
                  <div class="mt-2 text-xs text-gray-600">
                    <span class="mr-2"><%= t("bookmarks.index.sentence_category") %>:</span>
                    <span class="inline-block rounded border px-2 py-0.5 bg-gray-50"><%= t("enums.sentence.sentence_category.#{raw_cat}", default: raw_cat) %></span>
                  </div>
                <% end %>

                <%# タグ（文章）: 色付きチップ＋リンク（文章一覧のフィルタへ） %>
                <% if bm.bookmarkable.respond_to?(:sentence_tags) && bm.bookmarkable.sentence_tags.any? %>
                  <div class="relative z-50 pointer-events-auto mt-2 flex flex-wrap gap-2 max-h-16 overflow-y-auto">
                    <% bm.bookmarkable.sentence_tags.order(:name).each do |tag| %>
                      <%= link_to tag.name,
                          sentences_path(q: { sentence_tags_id_in: [tag.id] }),
                          class: "px-2 py-1 rounded-full border text-xs hover:opacity-80",
                          style: "background-color: #{tag.color.presence || '#000'}; color: #fff;" %>
                    <% end %>
                  </div>
                <% end %>
              <% end %>
            </div>

            <div class="shrink-0 pl-3">
              <%= render "bookmarks/star", record: bm.bookmarkable %>
            </div>
          </li>
        <% end %>
      </ul>

      <div class="mt-4">
        <%= paginate @bookmarks %>
      </div>
    <% end %>
  <% end %>
</div>