<div class="max-w-8xl mx-auto mt-6 space-y-4">
  <h1 class="text-2xl text-center font-semibold"><%= t(".title") %></h1>
  <%# 検索フォーム %>
  <%= render "search_form", q: @q %>
  <div class="flex justify-end gap-4 my-2 text-sm">
    <span><%= t("common.sort") %></span>
    <%= link_to t("common.update_desc"), url_for(params.permit!.to_h.merge(sort: 'updated_desc', page: nil)), class: 'underline' %>
    <%= link_to t("common.update_asc"), url_for(params.permit!.to_h.merge(sort: 'updated_asc',  page: nil)), class: 'underline' %>
    <%= link_to t("common.create_desc"), url_for(params.permit!.to_h.merge(sort: 'created_desc', page: nil)), class: 'underline' %>
    <%= link_to t("common.create_asc"), url_for(params.permit!.to_h.merge(sort: 'created_asc',  page: nil)), class: 'underline' %>
  </div>
  <%# 語彙表示 %>
  <div class="rounded-2xl bg-white text-gray-900 shadow divide-y overflow-hidden">
    <% @vocabularies.each do |v| %>
      <div class="relative p-4 flex items-start justify-between gap-4 hover:bg-gray-200 cursor-pointer">
        <div class="break-words">
          <div class="font-semibold text-lg inline"><%= truncate(v.word.to_s, length: 24, omission: "…") %></div>
          <span class="text-sm text-gray-500 ml-1"><%= truncate((v.reading.presence || t(".reading_none")).to_s, length: 48, omission: "…") %> / <%= t("enums.vocabulary.part_of_speech.#{v.part_of_speech}") %></span>
          <div class="mt-2 pl-3 border-l-4 border-blue-300">
            <div class="text-[11px] font-semibold text-blue-700 tracking-wide uppercase"><%= t(".mean_label") %></div>
            <div class="mt-1 text-sm text-gray-800 leading-relaxed break-words">
              <%= clamp_lines(v.meaning, max_lines: 3) %>
            </div>
          </div>
          <% if v.example.present? %>
            <div class="mt-2 pl-3 border-l-4 border-green-300">
              <div class="text-[11px] font-semibold text-green-700 tracking-wide uppercase"><%= t(".example_label") %></div>
              <div class="mt-1 text-xs text-gray-600 leading-relaxed break-words">
                <%= clamp_lines(v.example, max_lines: 3) %>
              </div>
            </div>
          <% end %>
        <%# タグを表示 (本文の下・内部スクロールで崩れ防止) %>
          <% if v.vocabulary_tags.any? %>
            <div class="relative z-50 pointer-events-auto mt-2 flex flex-wrap gap-2 max-h-16 overflow-y-auto">
              <% v.vocabulary_tags.order(:name).each do |tag| %>
                <%= link_to tag.name,
                    vocabularies_path(q: { vocabulary_tags_id_in: [tag.id] }),
                    class: "px-2 py-1 rounded-full border text-xs hover:opacity-80",
                    style: "background-color: #{tag.color.presence || '#000'}; color: #fff;" %>
              <% end %>
            </div>
          <% end %>
        </div>  
        <%# 作成日・更新日を表示 %>
        <div class="text-xs text-gray-500 text-right whitespace-nowrap">
          <div><%= t("common.created_day") %></div>
          <div><%= v.created_at.strftime("%Y/%m/%d %H:%M") %></div><br>
          <div><%= t("common.updated_day") %></div>
          <div><%= v.updated_at.strftime("%Y/%m/%d %H:%M") %></div>
        </div>
        <%= link_to "", vocabulary_path(v), class: "absolute inset-0", aria: { label: v.word } %>
      </div>
    <% end %>
    <%# 登録がない場合 %>
    <% if @vocabularies.empty? %>
      <div class="p-6 text-center text-gray-500"><%= t(".empty") %></div>
    <% end %>
  </div>
  <%# ページネーション %>
  <%= paginate @vocabularies %>
  <%= link_to t("common.return"), top_path, class: "ml-2 underline" %>
</div>
